# 添加索引

向Elasticsearch添加数据，我们需要_索引_——一个存储相关数据的地方。实际上，索引只是一个指向一个或多个物理 _分片_ 的`逻辑名字空间`。

_分片_是一个低级别的工作单元。每个分片都是Lucene的一个实例，并且是一个完整的独立的搜索引擎。文档存储在分片中，并且被索引到分片，但应用并不会直接访问它们。相反，应用会访问索引。

分片是Elasticsearch如何在集群中分发数据的方式，你可以把分片想象成数据的容器。文档存储在分片中，而分片则被分配给集群的各个节点。随着集群的扩大或者收缩，Elasticsearch将自动在节点之间迁移分片来保持集群的均衡。

一个分片可以是主分片或者副本分片。索引中的每个文档属于一个主分片，所以你拥有的主分片的数量就决定了你的索引能存储的数据的最大量。

****
虽然一个主分片可以存数据的量理论上没有限制，但实际上是有限制的。最大分片的大小完全取决于你的使用情况：你的硬件，你的文档的大小和复杂程度，你如何所以和查询你的文档，以及你期望的响应时间。
****

一个副本分片就是一个主分片的拷贝。副本被用于为你的数据提供冗余，以抵御硬件故障，并服务于类似检索的读请求。

一个索引的主分片数量是在它被创建时确定的，但副本分片的数量是随时可以改变的。

我们在单节点集群上创建一个叫做`blog`的索引。默认情况下，索引被分配5个主分片，但是在这个例子中，我们将只分片3个主分片和1个副本（每个主分片一个副本）：

```
PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}
```

我们的集群现在看起来像是一个**`有一个索引的单节点集群`**。3个主分片都被分配到了`节点1`。

![有一个索引的单节点集群](../images/elas_0202.png "有一个索引的单节点集群")
图1. 有一个索引的单节点集群

如果我们现在检查**`集群健康`**的话，我们将看到：

```
{
   "cluster_name":          "elasticsearch",
   "status":                "yellow", (1)
   "timed_out":             false,
   "number_of_nodes":       1,
   "number_of_data_nodes":  1,
   "active_primary_shards": 3,
   "active_shards":         3,
   "relocating_shards":     0,
   "initializing_shards":   0,
   "unassigned_shards":     3 (2)
}
```

1. 集群的`状态`是`黄色`。
2. 三个副本分片没有被分配到节点。

集群健康度为`黄色`表明所有主分片是正常的，工作的（集群能成功地响应任何请求），但不是所有的副本分片都是正常的。实际上，我们的三个分片现在都是`未被分配的`——它们没有被分配到节点。在同一个节点上存储相同数据的副本是没有意义的。如果这个节点宕掉，我们会丢失数据的所有副本。

现在我们的集群是功能齐全的，但是存在着因硬件故障导致的数据丢失的风险。
